<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Mixed effects models • modelbased</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Mixed effects models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">modelbased</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.12.0.17</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-file-code"></span> Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-introductions" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Introductions</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-introductions">
<li><a class="dropdown-item" href="../articles/overview_of_vignettes.html">Overview of Vignettes</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/visualisation_matrix.html">Data grids</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_means.html">Marginal means</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_contrasts.html">Contrast analysis</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_slopes.html">Marginal effects and derivatives</a></li>
    <li><a class="dropdown-item" href="../articles/mixed_models.html">Mixed effects models</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Interpretation</h6></li>
    <li><a class="dropdown-item" href="../articles/estimate_response.html">Use a model to make predictions</a></li>
    <li><a class="dropdown-item" href="../articles/derivatives.html">Interpret models using Effect Derivatives</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_grouplevel.html">Estimate and re-use Random Effects</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Visualization</h6></li>
    <li><a class="dropdown-item" href="../articles/plotting.html">Plotting estimated marginal means</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_relation.html">Visualize effects and interactions</a></li>
    <li><a class="dropdown-item" href="../articles/modelisation_approach.html">The modelisation approach</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-case-studies" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Case Studies</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-case-studies">
<li><h6 class="dropdown-header" data-toc-skip>Workflows</h6></li>
    <li><a class="dropdown-item" href="../articles/workflow_modelbased.html">Understanding your models</a></li>
    <li><a class="dropdown-item" href="../articles/practical_causality.html">Causal inference for observational data</a></li>
    <li><a class="dropdown-item" href="../articles/practical_intersectionality.html">Intersectionality analysis using the MAIHDA framework</a></li>
    <li><a class="dropdown-item" href="../articles/practical_inequalities.html">Measuring and comparing absolute and relative inequalities</a></li>
    <li><a class="dropdown-item" href="../articles/practical_its.html">Interrupted Time Series Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/practical_growthmixture.html">An Introduction to Growth Mixture Models</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Contrasts</h6></li>
    <li><a class="dropdown-item" href="../articles/introduction_comparisons_1.html">Contrasts and comparisons</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_comparisons_2.html">User Defined Contrasts and Joint Tests</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_comparisons_3.html">Slopes, floodlight and spotlight analysis (Johnson-Neyman intervals)</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_comparisons_4.html">Contrasts and comparisons for generalized linear models</a></li>
    <li><a class="dropdown-item" href="../articles/introduction_comparisons_5.html">Contrasts and comparisons for zero-inflation models</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper"></span> News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-easystats" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="easystats"><span class="fa fab fa-r-project"></span> easystats</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-easystats">
<li><a class="external-link dropdown-item" href="https://easystats.github.io/bayestestR/">bayestestR</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/correlation/">correlation</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/datawizard/">datawizard</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/easystats/">easystats</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/effectsize/">effectsize</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/insight/">insight</a></li>
    <li><a class="dropdown-item" href="https://easystats.github.io/modelbased/">modelbased</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/performance/">performance</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/parameters/">parameters</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/report/">report</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/see/">see</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="http://twitter.com/easystats4u" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/easystats/modelbased/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Mixed effects models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/easystats/modelbased/blob/main/vignettes/mixed_models.Rmd" class="external-link"><code>vignettes/mixed_models.Rmd</code></a></small>
      <div class="d-none name"><code>mixed_models.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="estimated-marginal-means-in-mixed-effects-models-navigating-conditional-and-marginal-effects">Estimated Marginal Means in Mixed Effects Models: Navigating
Conditional and Marginal Effects<a class="anchor" aria-label="anchor" href="#estimated-marginal-means-in-mixed-effects-models-navigating-conditional-and-marginal-effects"></a>
</h3>
<p>Mixed models, with their ability to account for hierarchical or
clustered data, offer powerful tools for understanding complex
relationships. A key aspect of interpreting these models is
understanding <strong>estimated marginal means (EMMs)</strong>, which
represent the predicted outcome for specific groups or conditions, while
holding other variables constant. However, calculating EMMs in mixed
models is not always straightforward, and the results can vary depending
on the approach taken.</p>
<p>One crucial distinction is between <strong>conditional</strong> and
<strong>marginal</strong> predictions (or effects). Conditional
predictions are specific to a particular level of the random effect
(e.g., the predicted outcome for a specific individual in a study).
Marginal predictions, on the other hand, average over the random
effects, providing an overall estimate of the effect in the population.
This is a crucial difference, as the marginal effect is often the
quantity of interest when we want to generalize to the population <span class="citation">(Heiss 2022)</span>.</p>
<p>Based on the definitions from Heiss (2022), we can say:</p>
<blockquote>
<p>This conditional vs. marginal distinction applies to any sort of
hierarchical structure in multilevel models:</p>
<ul>
<li>
<strong>Conditional effect</strong> = the effect of a variable in an
<em>average cluster</em> (i.e., group-specific, subject-specific or
cluster-specific effect, or an average or a typical cluster)</li>
<li>
<strong>Marginal effect</strong> = effect of a variable <em>across
clusters on average</em> (i.e., global/population-level effect, or
clusters on average).</li>
</ul>
</blockquote>
<p>When working with mixed models, the <code>modelbased</code> package
offers flexibility in calculating EMMs through different backends. The
<code>"marginaleffects"</code> backend and the <code>"emmeans"</code>
backend employ different underlying methodologies.
<strong>marginaleffects</strong> typically focuses on marginal
predictions by averaging over the random effects, while
<strong>emmeans</strong> provides conditional predictions. Consequently,
the EMMs obtained using these two backends may differ. As we will see,
conditional and marginal predictions for <em>fixed effects</em> focal
predictors…</p>
<ul>
<li>… are usually similar for linear mixed models</li>
<li>… are usually different for generalized linear mixed models</li>
<li>… are usually different for both linear and generalized linear
models, when the data is “imbalanced” and “average” predictions are
requested (i.e., <code>estimate = "average"</code>); by
<em>imbalanced</em> we mean not equally distributed levels.</li>
</ul>
<blockquote>
<p><strong>Note:</strong></p>
<p>If you request unit-level predictions - that is, predictions specific
to the individual levels of the random effects (achieved by including
random effect variables in <code>by</code>) - conditional and marginal
predictions will also differ in linear mixed models. We will not delve
into unit-level predictions in this vignette.</p>
</blockquote>
<p>In essence, the choice of backend and the understanding of whether we
are looking at conditional or marginal predictions are critical for
correctly interpreting the results of mixed models. Carefully
considering the research question and the nature of the random effects
will guide the selection of the appropriate approach.</p>
<blockquote>
<p><strong>Technical Notes:</strong></p>
<ul>
<li><p>For <code>backend = "marginaleffects"</code>, the
<code>re.form</code> argument is set to <code>NULL</code> for mixed
models by default, to calculate <em>marginal predictions</em>. You can
use for instance <code>re.form = NA</code> in your
<code><a href="../reference/estimate_means.html">estimate_means()</a></code> call to change the default value
(<code>NA</code> will produce <em>conditional
predictions</em>).</p></li>
<li><p>By default, both backends calculate predictions for a balanced
data grid representing all combinations of focal predictor levels
(specified in <code>by</code>). This represents a “typical” observation
based on the data grid and is useful for comparing groups. Setting
<code>estimate = "average"</code> can be useful to calculate the average
expected outcome from those observations <em>from the sample</em> at
hand, however, this option is only available for
<code>backend = "marginaleffects"</code>.</p></li>
</ul>
</blockquote>
<p>This vignette shows some examples to demonstrate where results are
similar and where they differ.</p>
</div>
<div class="section level3">
<h3 id="linear-mixed-models">Linear mixed models<a class="anchor" aria-label="anchor" href="#linear-mixed-models"></a>
</h3>
<div class="section level4">
<h4 id="balanced-data">Balanced Data<a class="anchor" aria-label="anchor" href="#balanced-data"></a>
</h4>
<p>This section demonstrates the calculation of estimated marginal means
(EMMs) in a linear mixed model using balanced data. We’ll use the
<code>sleepstudy</code> dataset from the <strong>lme4</strong>
package.</p>
<p>In this example, we fit a linear mixed model predicting
<code>Reaction</code> based on <code>Days</code>, with random intercepts
and slopes for <code>Subject</code>. We then calculate the EMMs for
<code>Days</code> using both the default <code>"marginaleffects"</code>
backend and the <code>"emmeans"</code> backend. Because the data is
balanced and we have a linear, the results are similar
(<strong>exception:</strong> we find small differences for the
confidence intervals, but ignore this for now…).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/modelbased/">modelbased</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sleepstudy</span>, package <span class="op">=</span> <span class="st">"lme4"</span><span class="op">)</span></span>
<span><span class="co"># for later, create a slightly imbalanced distributed predictor</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">sleepstudy</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sleepstudy</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">lme4</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Reaction</span> <span class="op">~</span> <span class="va">Days</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">Days</span> <span class="op">|</span> <span class="va">Subject</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">sleepstudy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># default, marginaleffects backend (marginal predictions)</span></span>
<span><span class="co"># in this case, same result as for conditional predictions</span></span>
<span><span class="fu"><a href="../reference/estimate_means.html">estimate_means</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"Days"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated Marginal Means</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days |               Mean (CI)</span></span>
<span><span class="co">#&gt; ------------------------------</span></span>
<span><span class="co">#&gt; 0    | 251.41 (237.94, 264.87)</span></span>
<span><span class="co">#&gt; 1    | 261.87 (248.48, 275.27)</span></span>
<span><span class="co">#&gt; 2    | 272.34 (258.34, 286.34)</span></span>
<span><span class="co">#&gt; 3    | 282.81 (267.60, 298.02)</span></span>
<span><span class="co">#&gt; 4    | 293.27 (276.39, 310.16)</span></span>
<span><span class="co">#&gt; 5    | 303.74 (284.83, 322.65)</span></span>
<span><span class="co">#&gt; 6    | 314.21 (293.03, 335.39)</span></span>
<span><span class="co">#&gt; 7    | 324.68 (301.05, 348.31)</span></span>
<span><span class="co">#&gt; 8    | 335.14 (308.94, 361.35)</span></span>
<span><span class="co">#&gt; 9    | 345.61 (316.74, 374.48)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variable predicted: Reaction</span></span>
<span><span class="co">#&gt; Predictors modulated: Days</span></span>
<span><span class="co">#&gt; Predictors averaged: Subject</span></span>
<span></span>
<span><span class="co"># emmeans backend, always conditional predictions</span></span>
<span><span class="fu"><a href="../reference/estimate_means.html">estimate_means</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"Days"</span>, backend <span class="op">=</span> <span class="st">"emmeans"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated Marginal Means</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days |               Mean (CI)</span></span>
<span><span class="co">#&gt; ------------------------------</span></span>
<span><span class="co">#&gt; 0    | 251.41 (237.01, 265.80)</span></span>
<span><span class="co">#&gt; 1    | 261.87 (247.55, 276.19)</span></span>
<span><span class="co">#&gt; 2    | 272.34 (257.37, 287.31)</span></span>
<span><span class="co">#&gt; 3    | 282.81 (266.55, 299.06)</span></span>
<span><span class="co">#&gt; 4    | 293.27 (275.22, 311.32)</span></span>
<span><span class="co">#&gt; 5    | 303.74 (283.53, 323.96)</span></span>
<span><span class="co">#&gt; 6    | 314.21 (291.57, 336.85)</span></span>
<span><span class="co">#&gt; 7    | 324.68 (299.42, 349.94)</span></span>
<span><span class="co">#&gt; 8    | 335.14 (307.13, 363.16)</span></span>
<span><span class="co">#&gt; 9    | 345.61 (314.75, 376.47)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variable predicted: Reaction</span></span>
<span><span class="co">#&gt; Predictors modulated: Days</span></span></code></pre></div>
<p>Here, we calculate the marginal predictions for the <code>Days</code>
variable using the <code>estimate = "average"</code> argument. In this
case, because the model is linear and the data is balanced, the
predictions are again the same as the previous results, i.e., averaging
across all observations makes no difference here.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># marginal predictions, averaged across all observations,</span></span>
<span><span class="co"># same as conditional predictions above</span></span>
<span><span class="fu"><a href="../reference/estimate_means.html">estimate_means</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"Days"</span>, estimate <span class="op">=</span> <span class="st">"average"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Average Predictions</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Days |               Mean (CI)</span></span>
<span><span class="co">#&gt; ------------------------------</span></span>
<span><span class="co">#&gt; 0    | 251.41 (237.94, 264.87)</span></span>
<span><span class="co">#&gt; 1    | 261.87 (248.48, 275.27)</span></span>
<span><span class="co">#&gt; 2    | 272.34 (258.34, 286.34)</span></span>
<span><span class="co">#&gt; 3    | 282.81 (267.60, 298.02)</span></span>
<span><span class="co">#&gt; 4    | 293.27 (276.39, 310.16)</span></span>
<span><span class="co">#&gt; 5    | 303.74 (284.83, 322.65)</span></span>
<span><span class="co">#&gt; 6    | 314.21 (293.03, 335.39)</span></span>
<span><span class="co">#&gt; 7    | 324.68 (301.05, 348.31)</span></span>
<span><span class="co">#&gt; 8    | 335.14 (308.94, 361.35)</span></span>
<span><span class="co">#&gt; 9    | 345.61 (316.74, 374.48)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variable predicted: Reaction</span></span>
<span><span class="co">#&gt; Predictors modulated: Days</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="imbalanced-data">Imbalanced Data<a class="anchor" aria-label="anchor" href="#imbalanced-data"></a>
</h4>
<p>This section explores the impact of imbalanced data on EMM
calculations in linear mixed models. We’ll use the <code>penguins</code>
dataset, which has imbalanced groups that we use as higher-level unit,
as well as imbalanced predictors. Since we have still a linear mixed
model, marginal and conditional predictions are still similar.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">penguins</span>, package <span class="op">=</span> <span class="st">"palmerpenguins"</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">lme4</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">bill_length_mm</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">island</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">species</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># marginal predictions</span></span>
<span><span class="fu"><a href="../reference/estimate_means.html">estimate_means</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"sex"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated Marginal Means</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; sex    |            Mean (CI)</span></span>
<span><span class="co">#&gt; -----------------------------</span></span>
<span><span class="co">#&gt; female | 43.29 (37.00, 49.58)</span></span>
<span><span class="co">#&gt; male   | 46.99 (40.70, 53.28)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variable predicted: bill_length_mm</span></span>
<span><span class="co">#&gt; Predictors modulated: sex</span></span>
<span><span class="co">#&gt; Predictors averaged: island, species</span></span>
<span></span>
<span><span class="co"># conditional predictions</span></span>
<span><span class="fu"><a href="../reference/estimate_means.html">estimate_means</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"sex"</span>, backend <span class="op">=</span> <span class="st">"emmeans"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated Marginal Means</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; sex    |            Mean (CI)</span></span>
<span><span class="co">#&gt; -----------------------------</span></span>
<span><span class="co">#&gt; female | 43.29 (29.54, 57.04)</span></span>
<span><span class="co">#&gt; male   | 46.99 (33.24, 60.74)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variable predicted: bill_length_mm</span></span>
<span><span class="co">#&gt; Predictors modulated: sex</span></span></code></pre></div>
<p>Since we have imbalanced data, results for “average” predictions will
differ from the results above, because both the <code>"emmeans"</code>
backend and the default <code>estimate</code> setting for the
<code>"marginaleffects"</code> backend produce “data grid based”
predictions, which do not average across all observations (see also <a href="https://easystats.github.io/modelbased/reference/estimate_means.html">the
documentation</a> of the <code>estimate</code> argument for further
details).</p>
<p>Furthermore, for imbalanced data, conditional and marginal
predictions will differ when they are averaged across all
observations.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># average marginal predictions</span></span>
<span><span class="fu"><a href="../reference/estimate_means.html">estimate_means</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"sex"</span>, estimate <span class="op">=</span> <span class="st">"average"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Average Predictions</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; sex    |            Mean (CI)</span></span>
<span><span class="co">#&gt; -----------------------------</span></span>
<span><span class="co">#&gt; female | 42.10 (35.81, 48.39)</span></span>
<span><span class="co">#&gt; male   | 45.85 (39.57, 52.14)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variable predicted: bill_length_mm</span></span>
<span><span class="co">#&gt; Predictors modulated: sex</span></span>
<span></span>
<span><span class="co"># average conditional predictions</span></span>
<span><span class="fu"><a href="../reference/estimate_means.html">estimate_means</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"sex"</span>, estimate <span class="op">=</span> <span class="st">"average"</span>, re.form <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="co">#&gt; Average Predictions</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; sex    |            Mean (CI)</span></span>
<span><span class="co">#&gt; -----------------------------</span></span>
<span><span class="co">#&gt; female | 43.26 (36.97, 49.54)</span></span>
<span><span class="co">#&gt; male   | 46.95 (40.66, 53.24)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variable predicted: bill_length_mm</span></span>
<span><span class="co">#&gt; Predictors modulated: sex</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="generalized-linear-mixed-models">Generalized linear mixed models<a class="anchor" aria-label="anchor" href="#generalized-linear-mixed-models"></a>
</h3>
<p>The generalized linear mixed model (GLMM) example, using a Poisson
distribution to model fish counts, demonstrates the substantial
differences between marginal and conditional predictions in non-linear
models. When examining the effect of the <code>camper</code> variable,
marginal predictions yield higher estimated means (1.26 for
<code>camper = 0</code> and 3.21 for <code>camper = 1</code>) compared
to conditional predictions (using <code>re.form = NA</code> or the
<code>"emmeans"</code> backend), which are lower (0.66 for
<code>camper = 0</code> and 1.68 for <code>camper = 1</code>).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"fish"</span>, package <span class="op">=</span> <span class="st">"insight"</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">lme4</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lme4/man/glmer.html" class="external-link">glmer</a></span><span class="op">(</span></span>
<span>  <span class="va">count</span> <span class="op">~</span> <span class="va">child</span> <span class="op">+</span> <span class="va">camper</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">persons</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">fish</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># marginal predictions</span></span>
<span><span class="fu"><a href="../reference/estimate_means.html">estimate_means</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"camper"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated Marginal Means</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; camper |          Mean (CI)</span></span>
<span><span class="co">#&gt; ---------------------------</span></span>
<span><span class="co">#&gt; 0      | 1.26 (-0.28, 2.79)</span></span>
<span><span class="co">#&gt; 1      | 3.21 (-0.68, 7.10)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variable predicted: count</span></span>
<span><span class="co">#&gt; Predictors modulated: camper</span></span>
<span><span class="co">#&gt; Predictors averaged: child (0.68), persons (1)</span></span>
<span><span class="co">#&gt; Predictions are on the response-scale.</span></span>
<span></span>
<span><span class="co"># conditional predictions</span></span>
<span><span class="fu"><a href="../reference/estimate_means.html">estimate_means</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"camper"</span>, re.form <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated Marginal Means</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; camper |          Mean (CI)</span></span>
<span><span class="co">#&gt; ---------------------------</span></span>
<span><span class="co">#&gt; 0      | 0.66 (-0.14, 1.46)</span></span>
<span><span class="co">#&gt; 1      | 1.68 (-0.36, 3.71)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variable predicted: count</span></span>
<span><span class="co">#&gt; Predictors modulated: camper</span></span>
<span><span class="co">#&gt; Predictors averaged: child (0.68), persons (1)</span></span>
<span><span class="co">#&gt; Predictions are on the response-scale.</span></span>
<span></span>
<span><span class="co"># conditional predictions</span></span>
<span><span class="fu"><a href="../reference/estimate_means.html">estimate_means</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"camper"</span>, backend <span class="op">=</span> <span class="st">"emmeans"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated Marginal Means</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; camper |         Rate (CI) | Rate</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt; 0      | 0.66 (0.19, 2.23) | 0.66</span></span>
<span><span class="co">#&gt; 1      | 1.68 (0.50, 5.64) | 1.68</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variable predicted: count</span></span>
<span><span class="co">#&gt; Predictors modulated: camper</span></span>
<span><span class="co">#&gt; Predictions are on the response-scale.</span></span></code></pre></div>
<p>Furthermore, when using <code>estimate = "average"</code> to average
across all observations, the differences between marginal and
conditional predictions persist, with marginal predictions showing
higher means (1.52 and 4.54) than conditional predictions (1.20 and
3.19), but both results differ from the predictions for “typical”
observations based on the default <code>estimate</code> option (or
<code>"emmeans"</code> backend), as shown in the previous output.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># average marginal predictions</span></span>
<span><span class="fu"><a href="../reference/estimate_means.html">estimate_means</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"camper"</span>, estimate <span class="op">=</span> <span class="st">"average"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Average Predictions</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; camper |           Mean (CI)</span></span>
<span><span class="co">#&gt; ----------------------------</span></span>
<span><span class="co">#&gt; 0      | 1.52 (-0.33,  3.38)</span></span>
<span><span class="co">#&gt; 1      | 4.54 (-0.95, 10.03)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variable predicted: count</span></span>
<span><span class="co">#&gt; Predictors modulated: camper</span></span>
<span><span class="co">#&gt; Predictions are on the response-scale.</span></span>
<span></span>
<span><span class="co"># average conditional predictions</span></span>
<span><span class="fu"><a href="../reference/estimate_means.html">estimate_means</a></span><span class="op">(</span><span class="va">model</span>, <span class="st">"camper"</span>, estimate <span class="op">=</span> <span class="st">"average"</span>, re.form <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="co">#&gt; Average Predictions</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; camper |          Mean (CI)</span></span>
<span><span class="co">#&gt; ---------------------------</span></span>
<span><span class="co">#&gt; 0      | 1.20 (-0.26, 2.66)</span></span>
<span><span class="co">#&gt; 1      | 3.19 (-0.67, 7.04)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variable predicted: count</span></span>
<span><span class="co">#&gt; Predictors modulated: camper</span></span>
<span><span class="co">#&gt; Predictions are on the response-scale.</span></span></code></pre></div>
<p>This highlights that in GLMMs, the choice between marginal and
conditional predictions significantly impacts the estimated means and,
consequently, the interpretation of the model’s results. In this case,
the marginal predictions are higher than the conditional
predictions.</p>
</div>
<div class="section level3">
<h3 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h3>
<p>This vignette has demonstrated the nuances of calculating estimated
marginal means (EMMs) in mixed models, highlighting the critical
distinction between conditional and marginal predictions. While
conditional predictions focus on specific levels of random effects,
marginal predictions average over them, providing a population-level
perspective. We’ve seen that in linear mixed models with balanced data,
these two approaches often yield similar results. However, in
generalized linear mixed models (GLMMs), the differences between
conditional and marginal predictions can be substantial.</p>
<p>Furthermore, the default approach of calculating predictions for a
balanced data grid, while useful for comparing groups, does not
necessarily reflect the actual distribution of observations in the
sample. For imbalanced data, this can yield significantly different
results even in linear mixed models in comparison to average predictions
(using <code>estimate = "average"</code>).</p>
<p><strong>Therefore, we recommend combining marginal predictions (using
the default <code>backend = "marginaleffects"</code>) with averaging
across all observations (by setting <code>estimate = "average"</code>)
when working with mixed models.</strong> This approach effectively
incorporates the variation inherent in the random effects (higher-level
units) and provides EMMs that more accurately reflect the overall
patterns observed within the actual sample data. By averaging over the
observed data, we obtain a more robust and representative estimate of
the population-level effects, making it a preferred strategy for
interpreting mixed model results.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-heiss_marginal_2022" class="csl-entry">
Heiss, Andrew. 2022. <span>“Marginal and Conditional Effects for
<span>GLMMs</span> with {Marginaleffects}.”</span> <em>Andrew Heiss’s
Blog</em>. <a href="https://doi.org/10.59350/xwnfm-x1827" class="external-link">https://doi.org/10.59350/xwnfm-x1827</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://dominiquemakowski.github.io/" class="external-link">Dominique Makowski</a>, <a href="https://github.com/strengejacke" class="external-link">Daniel Lüdecke</a>, <a href="https://home.msbstats.info/" class="external-link">Mattan S. Ben-Shachar</a>, <a href="https://sites.google.com/site/indrajeetspatilmorality/" class="external-link">Indrajeet Patil</a>, <a href="https://remi-theriault.com/" class="external-link">Rémi Thériault</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
